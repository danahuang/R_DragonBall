rm(list=ls())
##---------------- ???????????? ----------------
#setwd(dir) #??????working directory???????????????
# MAC : setwd("/Users/rladiestaipei/R_DragonBall/") 
setwd("C:\\Users\\nxf51120\\Desktop\\RBasic\\2019DragonBall") 
# Windows : setwd("C://Users/rladiestaipei/Desktop/R_DragonBall/")  

#????????????(??????????????????)
#install.packages(c("tidyverse","purrr","tidyr","plyr"), dependencies = TRUE)

#load packages
library(tidyverse)
library(purrr)
library(tidyr)
library(plyr)
options(dplyr.print_max=1e9)


##------------------------------------------------
## Part 1 : ????????????????????????
##------------------------------------------------
train0 <- read.csv("train.csv", stringsAsFactors = FALSE)

# ?????? Numeric and Character ??????
num_features <- names(which(sapply(train0, is.numeric)))
cat_features <- names(which(sapply(train0, is.character)))
train_numeric <- train0[, names(train0) %in% num_features]
train_categoric <- train0[, names(train0) %in% cat_features]

train0$OverallCond?<- as.factor(train0$OverallCond)
train0$OverallQual <- as.factor(train0$OverallQual)
train0$MSSubClass <- as.factor(train0$MSSubClass)

missing_values <- sapply(train0, function(x) sum(is.na(x)))

null_count <- data.frame(Column =names(missing_values), 
  ?                      Count = missing_values, 
                         Proportion = missing_values/nrow(train0)) %>%
  filter(Count > 0) %>%
  arrange(-Count)

#?????????????????? 80% ?????????
train0 <- train0 %>% 
  select(-c(as.vector(null_count$Column[null_count$Proportion>0.8])))


#?????????????????? (GarageCars, GarageArea)
#????????????????????? (BsmtFullBath, BsmtHalfBath, BsmtFinSF1, BsmtFinSF2, BsmtUnfSF, TotalBsmtSF)
#?????????????????? (MasVnrArea)
train0 <- train0 %>%
  replace_na(list(GarageCars = 0, GarageArea = 0, BsmtFullBath = 0, 
                  BsmtHalfBath = 0, BsmtFinSF1 = 0, BsmtFinSF2 = 0, 
                  BsmtUnfSF = 0, TotalBsmtSF = 0, MasVnrArea = 0))

# LotFrontage(??????????????????) ?????????????????????
train0$LotFrontage[is.na(train0$LotFrontage)] <- median(train0$LotFrontage, na.rm = T)

# GarageYrBlt(????????????) ?????? YearBuilt(??????????????????) ??????
train0$GarageYrBlt[is.na(train0$GarageYrBlt)] <- train0$YearBuilt[is.na(train0$GarageYrBlt)]


#?????????????????? (GarageFinish , GarageQual, GarageCond, GarageType)
#????????????????????? (BsmtCond, BsmtExposure, BsmtQual, BsmtFinType2, BsmtFinType1)
#???????????? (MasVnrType, FireplaceQu)
train0 <- train0 %>%
  replace_na(list(GarageFinish = "None", GarageQual = "None", 
                  GarageCond = "None", GarageType = "None",
                  BsmtExposure = "None", BsmtQual = "None",
                  BsmtCon? = "None", BsmtFinType1 = "None",
                  BsmtFinType2 = "None", MasVnrType = "None", FireplaceQu="None"))

# Electrical(????????????) ??????????????????
#?????? Mode Function
Mode <- function(x) {
  u_x <- unique(x)
  u_x[which.max(tabulate(match(x, u_x)))]
}
train0$Electrical[is.na(train0$Electrical)] <- Mode(train0$Electrical)


#???????????????????????? (GrLivArea, TotalSF, MasVnrArea) ????????????
train0$GrLivArea_stand <- scale(train0$GrLivArea)
train0$MasVnrArea_stand <- scale(train0$MasVnrArea)


#???????????????????????? (LotFrontage, SalePrice) ??? log transformation
train0$LotFrontage_log <- log(train0$LotFrontage)
train0$SalePrice_log <- log(train0$SalePrice)

#??????????????????,???????????????????????????
train0$is_Fireplace <- ifelse(train0$Fireplaces>0, "1", "0")


#??????????????????(BsmtCond)??????????????? 
#Ex=Excellent,Gd=Good,TA=Typical,Fa=Fair,Po=Poor,None=No Basement 
Qualities <- c('None' = 0, 'Po' = 1, 'Fa' = 2, 'TA' = 3, 'Gd' = 4, 'Ex' = 5)       
train0$BsmtCond <- as.integer( revalue(train0$BsmtCond, Qualities) )


#?????????????????? bathroom ??????
train0$TotalBathrooms <- train0$FullBath+(train0$HalfBath*0.5)+train0$BsmtFullBath+(train0$BsmtHalfBath*0.5)


##------------------------------------------------
## ???????????????
##------------------------------------------------
#????????? `TotalBsmtSF` ??? `X1stFlrSF` ??? `X2ndFlrSF` 
#1.?????????????????????????????? `TotalSF`
#2.??? `TotalSF` ??????????????????
dat<-train0%>%select(Id,TotalBsmtSF,X1stFlrSF,X2ndFlrSF)
head(dat) #LotArea MasVnrArea GrLivArea GarageArea PoolArea
dim(dat)
TTT<-dat%>%
  group_by(Id)%>%
  summarise(TotalSF=TotalBsmtSF+X1stFlrSF+X2ndFlrSF)
head(TTT)
dim(TTT)
train<-train0%>%
  left_joi?(TTT, by=c("Id"))
head(train)
